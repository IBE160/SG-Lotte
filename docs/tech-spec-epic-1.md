# Technical Specification: Epic 1 - First Plan & Foundation

## 1. Overview

Epic 1, "First Plan & Foundation," aims to establish the core technical foundation and the initial user experience for the AI Fitness & Meal Planner application. This includes user signup, onboarding, and the generation of the first personalized workout and meal plan. It is a foundational epic, laying the groundwork for all subsequent features.

## 2. Key Architectural Components (Relevant to Epic 1)

As defined in `architecture-2025-11-30.md`:

*   **Frontend:** Next.js (with App Router), TypeScript, Tailwind CSS.
*   **Backend:** FastAPI (Python), uvicorn.
*   **Database & BaaS:** Supabase (PostgreSQL) for database, authentication, Row Level Security (RLS), and storage.
*   **ORM/Database Migration:** Alembic.
*   **AI Integration:** Pydantic AI framework with Gemini 2.5 (to be integrated in Story 1.5).

## 3. Backend Implementation Guidelines

### 3.1 FastAPI Setup & Structure

*   The FastAPI application resides in the `backend/` directory, specifically `backend/app/main.py` for the main application instance.
*   API endpoints will be versioned (`/api/v1/`) and follow RESTful principles.
*   Dependencies are managed via `backend/requirements.txt`.

### 3.2 Supabase Integration

*   **Client Library:** Use `supabase-py` for backend interactions.
*   **Configuration:** Supabase client must be configured using API URL and Anon Key loaded from environment variables (e.g., `.env` file).
*   **Authentication:** Leverage Supabase Auth for user registration and login (covered in Story 1.3).
*   **Database Connection:** Ensure `psycopg2-binary` is used for PostgreSQL connectivity.

### 3.3 Alembic Migrations

*   **Initialization:** Alembic should be initialized within `backend/alembic/`.
*   **Configuration:** `alembic.ini` must be configured to connect to the Supabase PostgreSQL database.
*   **Usage:** Use Alembic for generating and applying database schema migrations to ensure controlled evolution of the database.

### 3.4 Naming Conventions

*   **API Endpoints:** Plural nouns and kebab-case (e.g., `/api/v1/workout-plans`).
*   **Database Tables:** Plural nouns and snake_case (e.g., `users`, `workout_plans`).
*   **Database Columns:** Snake_case (e.g., `user_id`, `created_at`).

### 3.5 Testing

*   All backend tests will reside in `backend/tests/`.
*   `Pytest` should be used for unit and integration testing.

## 4. Frontend Implementation Guidelines (for future stories in Epic 1)

### 4.1 Next.js & UI Framework

*   **Framework:** Next.js 14+ (App Router) with TypeScript.
*   **Styling:** Tailwind CSS for all styling.
*   **Component Library:** `shadcn/ui` components should be used where applicable.

### 4.2 Integration with Backend & Supabase

*   Frontend communicates with the FastAPI backend via `/api/v1/` REST endpoints.
*   Direct interaction with Supabase for authentication and real-time features using `supabase-js` client library.

### 4.3 UI/UX Adherence

*   Strictly follow the high-fidelity wireframes in `docs/ux-design/wireframes/` and the `ux-design-specification.md` for all visual and interactive elements.
*   Maintain dark-themed interface as specified.

## 5. Cross-cutting Concerns for Epic 1

### 5.1 Security

*   **Authentication:** Handled by Supabase Auth (JWTs for secure sessions).
*   **Authorization:** Implement and verify Supabase Row Level Security (RLS) policies for every new data model to ensure users can only access their own data. This is critical for data privacy.
*   **Data Security:** All data in transit (HTTPS) and at rest (managed by Supabase) must be encrypted.

### 5.2 Performance (ADR-002)

*   **Backend Caching:** The FastAPI backend will implement a caching layer (e.g., `fastapi-cache2` with an in-memory backend for MVP) for common database queries and computed results.
*   **Frontend Caching:** `SWR` or `React Query` should be used for client-side data fetching and caching to reduce API calls.

### 5.3 Logging

*   Structured logging should be implemented in the backend.
*   Logs will be in JSON format, containing timestamp, log level, and message.

## 6. Stories in Epic 1

*   **Story 1.1: Core Backend Setup:** (Current Story) Establishes FastAPI, Supabase connection, Alembic.
*   **Story 1.2: Core Frontend Setup:** Initializes Next.js project, Vercel CI/CD, basic frontend-backend connection.
*   **Story 1.3: User Registration & Email Verification:** Implements user signup/login using Supabase Auth, email verification.
*   **Story 1.4: Guided Onboarding Flow:** Frontend for 5-step onboarding, saving user preferences.
*   **Story 1.5: Initial AI Plan Generation & Display:** Integrates AI service for plan generation, displays plan on dashboard.

---

_Generated by BMAD Code Review Workflow_
_Date: onsdag 3. desember 2025_
_For: Epic 1 - First Plan & Foundation_
