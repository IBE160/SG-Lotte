<story-context id=".bmad/bmm/workflows/4-implementation/story-context/template" v="1.0">
  <metadata>
    <epicId>2</epicId>
    <storyId>1</storyId>
    <title>Workout Logging UI</title>
    <status>drafted</status>
    <generatedAt>2025-12-14</generatedAt>
    <generator>BMAD Story Context Workflow</generator>
    <sourceStoryPath>docs/sprint-artifacts/2-1-workout-logging-ui.md</sourceStoryPath>
  </metadata>

  <story>
    <asA>an active user</asA>
    <iWant>to easily log the completion status and perceived difficulty of my planned workouts</iWant>
    <soThat>the AI can track my progress</soThat>
    <tasks>
      <task id="1" for="AC#1, #2">Implement frontend components in the workout plan view to allow marking completion status and rating difficulty.</task>
      <task id="2" for="AC#3">Create a POST /api/v1/log/workout backend endpoint to receive and process workout log data.</task>
      <task id="3" for="AC#3">Create and configure the workout_logs table in Supabase to store the workout feedback, ensuring it's linked to the user and workout.</task>
    </tasks>
  </story>

  <acceptanceCriteria>
      <criterion id="1">Given I am viewing my daily workout plan, When I interact with a workout, Then I can mark it as "Completed" or "Skipped".</criterion>
      <criterion id="2">For completed workouts, I can rate the perceived difficulty on a 1-5 scale.</criterion>
      <criterion id="3">This workout feedback (status and difficulty) is successfully stored in the database.</criterion>
  </acceptanceCriteria>

  <artifacts>
    
    <docs>
      <doc>
        <path>docs/PRD.md</path>
        <title>Product Requirements Document</title>
        <section>FR-004: Workout Logging</section>
        <snippet>The system shall allow users to easily log the completion status and perceived difficulty of their planned workouts. Users can mark a planned workout as "Completed" or "Skipped" and rate the difficulty of a completed workout (e.g., 1-5 scale).</snippet>
      </doc>
      <doc>
        <path>docs/architecture-2025-11-30.md</path>
        <title>Architecture</title>
        <section>Epic 2 to Architecture Mapping</section>
        <snippet>-**Backend:** `app/api/v1/endpoints/plans.py` (Logging &amp; Adaptation Logic) `<br>` - **Frontend:** `src/app/(dashboard)/workouts/`, `src/app/(dashboard)/meals/` (Logging UI)</snippet>
      </doc>
      <doc>
        <path>docs/ux-design-specification.md</path>
        <title>UX Design Specification</title>
        <section>Flow 3 &amp; 4: Log Workouts, Meals &amp; Provide Feedback</section>
        <snippet>Tracking completed activities and providing feedback to the AI. Supporting Wireframes: workoutplan_dark.html: Enables detailed logging of sets, reps, and weights.</snippet>
      </doc>
      <doc>
        <path>docs/epics.md</path>
        <title>Epic Breakdown</title>
        <section>Story 2.1: Workout Logging UI</section>
        <snippet>As an active user, I want to easily log the completion status and perceived difficulty of my planned workouts, so the AI can track my progress. Technical Notes: Frontend UI implementation based on workoutplan_dark.html, API endpoint for logging workout status.</snippet>
      </doc>
      <doc>
        <path>docs/sprint-artifacts/tech-spec-epic-2.md</path>
        <title>Epic Technical Specification: Adaptive Planning & Progress Logging</title>
        <section>Traceability Mapping</section>
        <snippet>| 2.1 | 2.1.1, 2.1.2, 2.1.3 | Detailed Design | `WorkoutLoggingCard`, `POST /api/v1/log/workout` | Unit test the component's state changes. Integration test the API endpoint. |</snippet>
      </doc>
    </docs>
    
    <code>
      <artifact>
        <path>frontend/src/app/(dashboard)/dashboard/page.tsx</path>
        <kind>component</kind>
        <symbol>DashboardPage</symbol>
        <reason>Main UI for displaying workout plans. This will be modified to include the logging UI.</reason>
      </artifact>
      <artifact>
        <path>backend/app/api/v1/endpoints/plans.py</path>
        <kind>controller</kind>
        <symbol>router</symbol>
        <reason>A new endpoint for logging workouts will be added to this router.</reason>
      </artifact>
      <artifact>
        <path>backend/app/crud/plan.py</path>
        <kind>database</kind>
        <symbol>create_workout_plan</symbol>
        <reason>A new function `create_workout_log` will be added here, following the existing pattern.</reason>
      </artifact>
    </code>
    <dependencies>
      <ecosystem name="nodejs">
        <dependency name="next" version="16.0.8" />
        <dependency name="react" version="19.2.1" />
        <dependency name="@supabase/supabase-js" version="^2.87.1" />
        <dependency name="jest" version="^30.2.0" />
        <dependency name="typescript" version="^5" />
      </ecosystem>
      <ecosystem name="python">
        <dependency name="fastapi" />
        <dependency name="supabase" />
        <dependency name="pydantic-ai" />
        <dependency name="pytest" />
        <dependency name="google-generativeai" />
      </ecosystem>
    </dependencies>
  </artifacts>

  
  <constraints>
    <constraint>All backend endpoints must be protected, requiring a valid JWT from an authenticated user via Supabase.</constraint>
    <constraint>API requests and responses must be validated using Pydantic schemas.</constraint>
    <constraint>Row Level Security is enabled on all tables. Policies must be in place to ensure users can only access and modify their own data.</constraint>
    <constraint>Follow naming conventions from architecture-2025-11-30.md.</constraint>
  </constraints>
  <interfaces>
    <interface>
      <name>Log Workout</name>
      <kind>REST endpoint</kind>
      <signature>POST /api/v1/log/workout</signature>
      <path>backend/app/api/v1/endpoints/plans.py</path>
    </interface>
  </interfaces>
  
  <tests>
    <standards>
      The project uses Pytest for backend unit/integration tests and React Testing Library with Jest for frontend component tests. End-to-end tests covering the full user flow are expected.
    </standards>
    <locations>
      <location type="backend">/tests/</location>
      <location type="frontend">src/**/__tests__/</location>
    </locations>
    <ideas>
      <idea for="AC#1, #2">Frontend unit/integration tests (Jest/RTL) for the logging UI components.</idea>
      <idea for="AC#3">Backend unit/integration tests (Pytest) for the `/api/v1/log/workout` endpoint.</idea>
      <idea for="AC#1, #2, #3">End-to-end tests (Playwright/Cypress) to verify the entire logging flow from UI to database.</idea>
    </ideas>
  </tests>
</story-context>
