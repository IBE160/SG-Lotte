# Story 2.5: New Plan Notification

**Status:** ready-for-dev

**Epic:** Epic 2: Adaptive Planning & Progress Logging
**User:** Active User
**Value Statement:** As an active user, I want to be notified when my new weekly plans are ready, so I know when to check for updates.

---

## 1. Requirements & Context

### 1.1. Requirements Summary

This story is about implementing an in-app notification system to inform users when their new weekly plan is available. The notification should be clear and provide a direct link to the new plan.

### 1.2. Source Documents

*   **Tech Spec:** `docs/sprint-artifacts/tech-spec-epic-2.md#detailed-design`
*   **PRD:** `docs/PRD.md#fr-007-notifications`
*   **Epics:** `docs/epics.md#story-25-new-plan-notification`
*   **Architecture:** `docs/architecture-2025-11-30.md#epic-to-architecture-mapping`
*   **Wireframes:** `feedback_patterns_dark.html` (conceptual)

---

## 2. Acceptance Criteria

| # | Given | When | Then |
|---|---|---|---|
| 1 | A new plan has been generated by the AI | I open the app | I receive an in-app notification confirming the new plan |
| 2 | I receive a new plan notification | I interact with the notification | I can easily navigate to the new plan |

---

## 3. Implementation Plan

### 3.1. Task Breakdown

| Task ID | Description | Est. Time |
|---|---|---|
| 2.5.1 | Create the backend endpoint to trigger and manage in-app notifications. (AC: #1) | 3h |
| 2.5.2 | Implement the frontend UI for the notification based on the `feedback_patterns_dark.html` concept. (AC: #1, #2) | 3h |
| 2.5.3 | Implement the client-side logic to check for new notifications and display them. (AC: #1, #2) | 2h |
| 2.5.4 | **Test:** Write unit tests for the frontend UI of the notification. (AC: #1) | 1.5h |
| 2.5.5 | **Test:** Write integration tests for the backend endpoint to trigger and manage notifications. (AC: #1) | 1.5h |
| 2.5.6 | **Test:** Write E2E tests for the complete notification system, verifying display and navigation. (AC: #1, #2) | 1.5h |

### 3.2. Developer Notes

#### Project Structure Notes
*   The backend endpoint to trigger and manage notifications should be added to `backend/app/api/v1/endpoints/plans.py`.
*   The frontend UI for notifications should be created as a shared component, potentially in `frontend/src/components/shared/notifications/`.

#### General Notes
*   The notification should be non-intrusive yet clearly visible to the user, balancing user experience with crucial information delivery. Upon successful creation of the new plan, the backend service creates a "Your new weekly plan is ready!" notification and saves it to the `notifications` table as specified in the workflows. [Source: docs/sprint-artifacts/tech-spec-epic-2.md#workflows-and-sequencing]
*   For the MVP, a check on app load is sufficient for notification retrieval. The frontend will fetch unread notifications from the `GET /notifications` endpoint, adhering to the defined API contracts. [Source: docs/sprint-artifacts/tech-spec-epic-2.md#apis-and-interfaces]

---

## Dev Agent Record

*   **Context Reference:**
    *   docs/sprint-artifacts/2-5-new-plan-notification.context.xml
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes List:**
*   **File List:**

---

## 4. Validation

### 4.1. Validation Checklist

*   [ ] **AC #1:** An in-app notification is correctly displayed to the user when a new weekly plan is ready.
*   [ ] **AC #2:** The user can easily navigate to the new plan by interacting with the notification.
*   [ ] **Testing:** All unit, integration, and E2E tests for the notification system pass.

### 4.2. Review

*   **Completed by:**
*   **Date:**
*   **Outcome:**

---

## 5. Change Log

| Version | Date | Author | Change |
|---|---|---|---|
| 1.0 | 2025-12-02 | sm | Initial draft |
