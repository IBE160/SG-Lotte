# Story 1.5: Initial AI Plan Generation & Display

**Status:** drafted

**Epic:** Epic 1: First Plan & Foundation
**User:** New User
**Value Statement:** As a new user who has completed onboarding, I want to immediately see my first AI-generated "diagnostic" workout and meal plan on my dashboard, so I can begin my health journey.

---

## 1. Requirements & Context

### 1.1. Requirements Summary

This story is about the initial generation and display of the user's personalized workout and meal plan. After the user completes the onboarding, the backend should trigger an AI service to generate a 7-day plan. This plan should then be stored in the database and displayed on the user's dashboard.

### 1.2. Source Documents

*   **Tech Spec:** `docs/sprint-artifacts/tech-spec-epic-1.md#detailed-design`
*   **PRD:** `docs/PRD.md#fr-002-ai-driven-workout-plan-generation--adaptation`
*   **Epics:** `docs/epics.md#story-15-initial-ai-plan-generation--display`
*   **Architecture:** `docs/architecture-2025-11-30.md#epic-to-architecture-mapping`
*   **Wireframes:** `dashboard_dark.html` (conceptual)

---

## 2. Acceptance Criteria

| # | Given | When | Then |
|---|---|---|---|
| 1 | I have completed the onboarding flow | My dashboard loads | A 7-day personalized workout and meal plan is generated by the AI (OpenAI GPT-4) |
| 2 | A plan has been generated | My dashboard loads | The generated plan is displayed on the dashboard, similar to `dashboard_dark.html` |
| 3 | A plan has been generated | | The plan details are stored in the database |

---

## 3. Implementation Plan

### 3.1. Task Breakdown

| Task ID | Description | Est. Time |
|---|---|---|
| 1.5.1 | Create the backend service (`ai_plan_generator.py`) to interact with the OpenAI GPT-4 API. (AC: #1) | 4h |
| 1.5.2 | Implement the API endpoint to trigger the plan generation. (AC: #1) | 2h |
| 1.5.3 | Integrate the plan generation with the database to store the generated plans. (AC: #3) | 2h |
| 1.5.4 | Implement the frontend dashboard component to display the plan. (AC: #2) | 4h |
| 1.5.5 | **Test:** Write unit tests for the AI plan generator service. (AC: #1) | 1.5h |
| 1.5.6 | **Test:** Write component tests for the dashboard display. (AC: #2) | 1.5h |
| 1.5.7 | **Test:** Write integration tests to verify that the plan is correctly stored in the database. (AC: #3) | 1.5h |
| 1.5.8 | **Test:** Write an E2E test for the entire plan generation and display flow. (AC: #1, #2, #3) | 1.5h |

### 3.2. Developer Notes

#### Project Structure Notes
*   The AI plan generator service should be created at `backend/app/services/ai_plan_generator.py`.
*   The API endpoint to trigger plan generation should be in `backend/app/api/v1/endpoints/plans.py`.
*   The frontend dashboard component should be located at `frontend/src/app/(dashboard)/dashboard/page.tsx`.

#### General Notes
*   The interaction with the OpenAI API is a core part of this story. The backend's AI Plan Generator Service constructs a detailed prompt using the user's preferences and sends it to the OpenAI GPT-4 API, as outlined in the workflow. [Source: docs/sprint-artifacts/tech-spec-epic-1.md#workflows-and-sequencing]
*   The dashboard UI should be based on the `dashboard_dark.html` wireframe concept. The frontend will automatically call the `POST /plans/generate-initial` endpoint to trigger the creation of the user's first plan, following the defined API contracts. [Source: docs/sprint-artifacts/tech-spec-epic-1.md#workflows-and-sequencing]
*   Robust error handling, including retry mechanisms with exponential backoff for OpenAI API calls, is critical for the AI service interaction to ensure reliability and fault tolerance, as detailed in the non-functional requirements. [Source: docs/sprint-artifacts/tech-spec-epic-1.md#reliability-availability]

---

## Dev Agent Record

*   **Context Reference:**
*   **Agent Model Used:**
*   **Debug Log References:**
*   **Completion Notes List:**
*   **File List:**

---

## 4. Validation

### 4.1. Validation Checklist

*   [ ] **AC #1:** A 7-day personalized workout and meal plan is successfully generated by the AI after onboarding.
*   [ ] **AC #2:** The generated plan for the current day is correctly displayed on the user's dashboard.
*   [ ] **AC #3:** The complete 7-day plan is accurately stored in the database.
*   [ ] **Testing:** All unit, component, integration, and E2E tests for the plan generation and display flow pass.

### 4.2. Review

*   **Completed by:**
*   **Date:**
*   **Outcome:**

---

## 5. Change Log

| Version | Date | Author | Change |
|---|---|---|---|
| 1.0 | 2025-12-02 | sm | Initial draft |
